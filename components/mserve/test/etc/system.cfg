#---------------------------------- system.cfg content -----------------------#
  # Main system configuration file. Contains general system configuration and 
  # definitions of all components used within the system.
  
  # All general configuration fields for etc/system.cfg file are declared in qsl/system.qsd file. 
  # Note that qsd (q schema definition) file contains also default values.
  
  # Additional component-specific fields can be declared in the components' qsd file 
  #  e.g. q:rdb/rdb component has additional rdb-specific configuration declaration in rdb/rdb.qsd 
  # (see components section for examples).

#---------------------------------- env vars from etc/env.sh -----------------#	
  # Mandatory env variables that must be defined in etc/env.sh:
  # EC_ETC_PATH           - path to etc directory containing system.cfg, dataflow.cfg and access.cfg. Must be the same 
  #                         as etcPath field
  # EC_QSL_PATH           - path to qsl library - used for system bootstrapping
  
  # Optional env variables that can be defined in etc/env.sh:
  # EC_SYS_PATH           - root path of the entire system
  # EC_SYS_ID             - system ID
  # EC_SYS_TYPE           - system type - e.g. DEV1, DEV2, QA1, PROD1, PROD2

#---------------------------------- env vars from yak ------------------------#
  # Env variables generated for each process by yak:
  # EC_COMPONENT_ID       - component id in the system, e.g. core.rdb (extracted from subsection name)
  # EC_COMPONENT_INSTANCE - component instance (relevant in case of clones)
  # EC_COMPONENT_PKG      - component package, e.g. rdb (extracted from "type" field in the component subsection)
  # EC_COMPONENT_TYPE     - component type, e.g. rdb (extracted from "type" field in the component subsection)
  #                         Note: type field format "q:EC_COMPONENT_PKG/EC_COMPONENT_TYPE"
  # EC_COMPONENT          - component name, e.g. rdb (extracted from subsection suffix)
  # EC_GROUP              - component group - e.g. core (extracted from "group" section)
  
  # Additional list of fields that should be exported by yak as env variables. 
  # Those variables are used during process bootstrapping - i.e. before full configuration of the system is loaded into 
  # q process.
  # Note that each variable will be prefixed with EC and turned into CAPITAL letters with _ word-separator.
  # e.g: libPath will be exported as EC_LIB_PATH
export = libPath, dllPath, logDest, logPath, logRotate, logLevel, eventPath

#---------------------------------- paths ------------------------------------#
  # Configuration directory, should contain system.cfg, dataflow.cfg and access.cfg files.
etcPath = ${EC_ETC_PATH}

  # Definition of bin path directory, should point to the component sources location.
binPath = ${EC_SYS_PATH}/bin/ec/components/${EC_COMPONENT_PKG}

  # List of directories with libraries
libPath = ${EC_SYS_PATH}/bin/ec/components/${EC_COMPONENT_PKG}, ${EC_SYS_PATH}/bin/ec/libraries/

  # List of directories with binary libraries
dllPath = ${EC_SYS_PATH}/bin/ec/components/${EC_COMPONENT_PKG}, ${EC_SYS_PATH}/bin/ec/libraries/

  # Definition of data root directory, should contain all data generated by processes
dataPath = ${EC_SYS_PATH}/data/${EC_COMPONENT_ID}

  # Definition of log root directory, should contain logs from all processes within the system
logPath = ${EC_SYS_PATH}/log/${EC_COMPONENT_ID}

  # Path for event files - see qsl/event.q for more details.
eventPath = ${EC_SYS_PATH}/data/shared/events/

#---------------------------------- process ----------------------------------#
  # Base port used by the system, all other ports are relative to it.
  # The basePort variable together with $EC_SYS_PATH path allows easy 
  # creation of second running instance of the entire system on the same machine.
basePort = 17000

  # Delay after start command. 
startWait = 0.1

  # Delay after stop command. 
stopWait = 0.1

  # List of cores that are assigned to the process, can be overwritten on group or component level.
cpuAffinity = 0

#---------------------------------- logging ----------------------------------#
  # Logging level - DEBUG, INFO, WARN, ERROR or FATAL
logLevel = INFO

  # Logging destination - FILE, STDERR, STDOUT
logDest = FILE,STDERR

  # Log rotation time
logRotate = 01:00:00

#---------------------------------- housekeeping -----------------------------#
  # Default housekeeping action for all components.
housekeeping = ()

#---------------------------------- components -------------------------------#
  # Section with the group name, should contain one or more subsections with processes definitions.
  # Subsection should contain definition of components that are part of the group.
  # Subsection headers should contain component id (exported by yak as EC_COMPONENT_ID).
[group:t]

  [[t.run]]
    command = "q qtestRunner.q"
    type = q:qtest/qtestRunner
    port = ${basePort}
    memCap = 10000
    testFiles = ${EC_SYS_PATH}/bin/ec/components/mserve/test/mserve_functionalTests.q
    testNamespaces = .tmserve
    
  [[mock.backend:5]]                # process returning queries with instance numbers 
    binPath = ${EC_SYS_PATH}/bin/ec/components/mserve/test/
    command = "q mockBackend.q"       
    type = q:mock/mockBackend         
    port = ${basePort} + 11  + ${EC_COMPONENT_INSTANCE} # General config field    - port 
    memCap = 1000            # General config field    - q process memory cap in MB (-w q option)

  [[t.mserve]]
  command = "q mserve.q"
  type = q:mserve/mserve
  port = ${basePort} + 30
  memCap = 10000
  cfg.dataSource = mock.backend
  
  [[t.client]]
    binPath = ${EC_SYS_PATH}/bin/ec/components/mserve/test/
    command = "q mockClient.q"
    type = q:mock/mockClient
    port = ${basePort} + 32

#-----------------------------------------------------------------------------#
	
